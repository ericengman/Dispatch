---
milestone: v2.0
audited: 2026-02-09
status: passed
scores:
  requirements: 33/33
  phases: 9/9
  integration: 15/15
  flows: 6/6
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - source: STATE.md
    items:
      - "20 skills still use hardcoded `/tmp` paths instead of Dispatch library"
      - "Phase 11 migrated only 4 skills; remaining skills need migration"
      - "Status monitoring only starts for resumed sessions (not new sessions until they get claudeSessionId)"
---

# v2.0 Milestone Audit: In-App Claude Code

**Status:** PASSED ✓
**Audited:** 2026-02-09
**Milestone Goal:** Replace Terminal.app dependency with embedded terminal sessions, enabling full Claude Code management within Dispatch.

## Executive Summary

Milestone v2.0 achieved all objectives. The app now runs Claude Code in embedded SwiftTerm terminals instead of controlling external Terminal.app windows. All 33 requirements satisfied, all 9 phases verified, excellent cross-phase integration.

## Requirements Coverage

### Terminal Core (8/8)

| ID | Requirement | Phase | Status |
|----|-------------|-------|--------|
| TERM-01 | SwiftTerm package dependency | 14 | ✓ Complete |
| TERM-02 | EmbeddedTerminalView wrapper | 14 | ✓ Complete |
| TERM-03 | Thread-safe data reception | 15 | ✓ Complete |
| TERM-04 | Claude Code process spawning | 17 | ✓ Complete |
| TERM-05 | PTY-based prompt dispatch | 17 | ✓ Complete |
| TERM-06 | Output pattern completion detection | 17 | ✓ Complete |
| TERM-07 | JSONL status parsing | 21 | ✓ Complete |
| TERM-08 | Context window visualization | 21 | ✓ Complete |

### Process Lifecycle (5/5)

| ID | Requirement | Phase | Status |
|----|-------------|-------|--------|
| PROC-01 | TerminalProcessRegistry | 16 | ✓ Complete |
| PROC-02 | PID persistence | 16 | ✓ Complete |
| PROC-03 | Orphan cleanup | 16 | ✓ Complete |
| PROC-04 | Graceful termination | 16 | ✓ Complete |
| PROC-05 | Process group termination | 16 | ✓ Complete |

### Multi-Session (6/6)

| ID | Requirement | Phase | Status |
|----|-------------|-------|--------|
| SESS-01 | Multiple sessions | 18 | ✓ Complete |
| SESS-02 | Tab/panel display | 18 | ✓ Complete |
| SESS-03 | Split pane view | 18 | ✓ Complete |
| SESS-04 | Session focus state | 18 | ✓ Complete |
| SESS-05 | Full-screen mode | 18 | ✓ Complete |
| SESS-06 | Session limit | 18 | ✓ Complete |

### Persistence (5/5)

| ID | Requirement | Phase | Status |
|----|-------------|-------|--------|
| PERS-01 | SwiftData model | 19 | ✓ Complete |
| PERS-02 | Project relationship | 19 | ✓ Complete |
| PERS-03 | Metadata persistence | 19 | ✓ Complete |
| PERS-04 | Session resume | 19 | ✓ Complete |
| PERS-05 | Stale handling | 19 | ✓ Complete |

### Integration (5/5)

| ID | Requirement | Phase | Status |
|----|-------------|-------|--------|
| INTG-01 | EmbeddedTerminalService | 20 | ✓ Complete |
| INTG-02 | Queue execution wiring | 20 | ✓ Complete |
| INTG-03 | Chain execution wiring | 20 | ✓ Complete |
| INTG-04 | ExecutionStateMachine integration | 20 | ✓ Complete |
| INTG-05 | HookServer + pattern detection | 20 | ✓ Complete |

### Migration (4/4)

| ID | Requirement | Phase | Status |
|----|-------------|-------|--------|
| MIGR-01 | TerminalService replacement | 22 | ✓ Complete |
| MIGR-02 | Embedded terminal UI | 22 | ✓ Complete |
| MIGR-03 | Permission removal | 22 | ✓ Complete |
| MIGR-04 | Embedded-only execution | 22 | ✓ Complete |

## Phase Verification Summary

| Phase | Name | Plans | Status |
|-------|------|-------|--------|
| 14 | SwiftTerm Integration | 1/1 | ✓ Passed |
| 15 | Safe Terminal Wrapper | 1/1 | ✓ Passed |
| 16 | Process Lifecycle | 2/2 | ✓ Passed |
| 17 | Claude Code Integration | 4/4 | ✓ Passed |
| 18 | Multi-Session UI | 2/2 | ✓ Passed |
| 19 | Session Persistence | 2/2 | ✓ Passed |
| 20 | Service Integration | 2/2 | ✓ Passed |
| 21 | Status Display | 1/1 | ✓ Passed |
| 22 | Migration & Cleanup | 7/7 | ✓ Passed |

**Total:** 22 plans executed across 9 phases

## Cross-Phase Integration

### Service Layer Wiring

| Export | Provider | Consumer | Status |
|--------|----------|----------|--------|
| EmbeddedTerminalView | Phase 14 | SessionPaneView (18) | ✓ Connected |
| TerminalProcessRegistry | Phase 16 | ClaudeCodeLauncher (17) | ✓ Connected |
| ClaudeCodeLauncher | Phase 17 | EmbeddedTerminalView (18) | ✓ Connected |
| TerminalSessionManager | Phase 18 | EmbeddedTerminalService (20) | ✓ Connected |
| TerminalSession @Model | Phase 19 | UI, Services, Persistence | ✓ Connected |
| EmbeddedTerminalService | Phase 20 | ExecutionManager (20) | ✓ Connected |
| SessionStatusMonitor | Phase 21 | TerminalSessionManager (21) | ✓ Connected |
| ExecutionManager | Phase 17/20 | All ViewModels | ✓ Connected |

**Integration Score:** 15/15 critical connections verified (100%)

### E2E Flow Verification

| Flow | Path | Status |
|------|------|--------|
| Direct Prompt | Cmd+Enter → ExecutionManager → EmbeddedTerminalService → PTY | ✓ Complete |
| Queue Execution | Run Next/All → ExecutionManager → embedded terminal | ✓ Complete |
| Chain Execution | Chain trigger → sequential dispatch with delays | ✓ Complete |
| Session Creation | New session → TerminalSessionManager → Claude launch | ✓ Complete |
| Session Persistence | App close → SwiftData → resume on reopen | ✓ Complete |
| Project Terminal | Open in terminal → session with workingDirectory | ✓ Complete |

**Flow Score:** 6/6 E2E flows verified (100%)

## Tech Debt (Non-Blocking)

Items deferred to future milestones:

### From v1.1 (Phase 11)
- 20 skills still use hardcoded `/tmp` paths instead of Dispatch library
- Phase 11 migrated only 4 skills; remaining skills need migration for complete integration

### From v2.0 (Phase 21)
- Status monitoring only starts for resumed sessions (not new sessions until they get claudeSessionId)

### Deprecation Timeline
- TerminalService actor: deprecated (removal planned for v3.0)
- Skill.runInExistingTerminal/runInNewTerminal: deprecated (removal v3.0)
- TerminalPickerView: deprecated (no active UI usage)

## Architectural Highlights

### Key Design Decisions

1. **SwiftTerm + LocalProcess** pattern (proven in AgentHub reference app)
2. **Multi-session split panes** with tab bar for navigation
3. **UUID-based session registry** for cross-component lookup
4. **Dual completion detection** (HookServer primary, pattern fallback)
5. **Full Terminal.app replacement** (no hybrid mode)
6. **Session persistence via SwiftData** with 7-day retention

### Performance Characteristics

- Plans executed: 22 plans in 91.2m total (~4.1m average)
- Gap closure: 2 phases required gap closure plans (17, 22)
- Re-verification: All gaps successfully closed

## Conclusion

Milestone v2.0 "In-App Claude Code" has successfully achieved its definition of done:

1. ✓ Terminal.app dependency eliminated (deprecated, not deleted for rollback safety)
2. ✓ Embedded terminal sessions fully functional
3. ✓ Multi-session support with persistence
4. ✓ All execution paths use embedded terminals
5. ✓ No external permissions required

**Recommendation:** Proceed to milestone completion and archive.

---

*Audit completed: 2026-02-09*
*Integration checker: gsd-integration-checker*
*Verification method: Code trace + pattern matching*
