# Milestone v3.0: Screenshot Capture

**Status:** ✅ SHIPPED 2026-02-10
**Phases:** 23-27
**Total Plans:** 7

## Overview

Add quick screenshot capture with annotation and dispatch to Claude sessions. Enables capturing any screen region or window from anywhere, annotating with existing markup tools, and dispatching to specific Claude Code sessions.

## Phases

### Phase 23: Region Capture

**Goal**: User can capture any screen region with native cross-hair selection
**Depends on**: Nothing (first phase of v3.0)
**Requirements**: CAPT-01
**Plans**: 1 plan

Plans:
- [x] 23-01-PLAN.md — ScreenshotCaptureService with region capture via screencapture CLI

**Details:**
- Native `screencapture -i` for cross-hair selection
- QuickCaptures directory in Application Support
- CaptureResult enum for success/cancelled/error states

### Phase 24: Window Capture

**Goal**: User can capture entire windows with interactive selection
**Depends on**: Phase 23
**Requirements**: CAPT-02, CAPT-03
**Plans**: 1 plan

Plans:
- [x] 24-01-PLAN.md — Interactive window capture with WindowCaptureSession

**Details:**
- Custom WindowCaptureSession with hover-to-highlight
- CGWindowListCopyWindowInfo for window detection
- Floating control panel with Cancel/Capture buttons
- Filters out Dock, SystemUI, invisible windows
- `screencapture -l` for window-specific capture

### Phase 25: Annotation Integration

**Goal**: Captured screenshots flow into annotation UI for markup before dispatch
**Depends on**: Phase 24
**Requirements**: ANNOT-01, ANNOT-02, ANNOT-03
**Plans**: 2 plans

Plans:
- [x] 25-01-PLAN.md — QuickCapture model, WindowGroup, auto-open wiring
- [x] 25-02-PLAN.md — Session picker and dispatch integration

**Details:**
- QuickCapture model with Hashable+Codable for WindowGroup identity
- CaptureCoordinator for capture-to-window coordination
- QuickCaptureAnnotationView reuses existing annotation infrastructure
- SessionPickerView for target session selection
- Auto-select active session, validation gating, auto-close on dispatch

### Phase 26: Sidebar Integration

**Goal**: Quick Capture UI section in sidebar with recent captures and window thumbnails
**Depends on**: Phase 25
**Requirements**: UI-01, UI-04, CAPT-04
**Plans**: 1 plan

Plans:
- [x] 26-01-PLAN.md — QuickCaptureManager, ThumbnailCache, and sidebar section

**Details:**
- QuickCaptureManager with MRU list persistence to UserDefaults
- ThumbnailCache actor with CGImageSource for 120px thumbnails
- Quick Capture sidebar section with Region/Window buttons
- Horizontal thumbnail grid with hover-to-reveal re-capture
- Auto-add captures to MRU from CaptureCoordinator

### Phase 27: Polish

**Goal**: Keyboard shortcuts enable rapid capture workflows
**Depends on**: Phase 26
**Requirements**: UI-02
**Plans**: 1 plan

Plans:
- [x] 27-01-PLAN.md — Multi-hotkey manager, capture shortcuts, settings UI

**Details:**
- Multi-hotkey infrastructure with dictionary-based registration
- Region capture: Ctrl+Cmd+1 (global)
- Window capture: Ctrl+Cmd+2 (global)
- Capture shortcuts display in settings (read-only in v3.0)
- Proper cleanup on app termination

---

## Milestone Summary

**Key Decisions:**
- Use native screencapture CLI instead of custom overlay (zero custom UI)
- Custom WindowCaptureSession for interactive hover-highlight (better UX than system picker)
- Static cache for QuickCapture images (avoid SwiftData persistence requirement)
- Value-based WindowGroup for multiple simultaneous annotation windows
- UserDefaults for MRU persistence (lightweight, no SwiftData needed)
- Actor-based ThumbnailCache for thread-safe caching
- Default shortcuts Ctrl+Cmd+1/2 avoid system conflicts

**Issues Resolved:**
- Window capture UX: Replaced SCContentSharingPicker with custom hover-highlight (user-requested)
- Immediate capture: Added click-to-select flow so user can prepare window state

**Issues Deferred:**
- UI-03 (live thumbnail previews in picker): Hover-highlight provides equivalent value
- Shortcut customization: Read-only display in v3.0, customization deferred

**Technical Debt Incurred:**
- 40 actor isolation warnings in pre-v3.0 code (unrelated to v3.0)

---

_For current project status, see .planning/MILESTONES.md_
_Archived: 2026-02-10 as part of v3.0 milestone completion_
