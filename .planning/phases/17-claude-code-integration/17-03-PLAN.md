---
phase: 17-claude-code-integration
plan: 03
type: execute
wave: 3
depends_on: ["17-01", "17-02"]
files_modified:
  - Dispatch/Views/MainView.swift
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Opening terminal panel launches Claude Code, not shell"
    - "Claude Code colored output visible immediately"
  artifacts:
    - path: "Dispatch/Views/MainView.swift"
      provides: "Claude Code as default terminal mode"
      contains: "launchMode: .claudeCode"
  key_links:
    - from: "Dispatch/Views/MainView.swift"
      to: "EmbeddedTerminalView"
      via: "launchMode parameter"
      pattern: "EmbeddedTerminalView\\(launchMode:"
---

<objective>
Wire Claude Code as the default launch mode for the embedded terminal panel.

Purpose: Close Gap 1 from verification - MainView currently uses default .shell mode, making Claude Code integration infrastructure unreachable from UI.
Output: Terminal panel launches Claude Code directly when toggled open.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-claude-code-integration/17-01-SUMMARY.md
@.planning/phases/17-claude-code-integration/17-02-SUMMARY.md
@Dispatch/Views/MainView.swift
@Dispatch/Views/Terminal/EmbeddedTerminalView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Change terminal launch mode to Claude Code</name>
  <files>Dispatch/Views/MainView.swift</files>
  <action>
  Change line 100 from:
  ```swift
  EmbeddedTerminalView()
  ```

  To:
  ```swift
  EmbeddedTerminalView(launchMode: .claudeCode(workingDirectory: nil, skipPermissions: true))
  ```

  This makes Claude Code the default when user opens the terminal panel (Cmd+Shift+T).

  The workingDirectory is nil for now (will be wired to project path in Phase 20).
  skipPermissions: true matches the 17-01 decision for embedded usage friction reduction.
  </action>
  <verify>
  Build succeeds:
  ```bash
  xcodebuild -project Dispatch.xcodeproj -scheme Dispatch -configuration Debug build 2>&1 | tail -5
  ```

  Grep confirms launch mode:
  ```bash
  grep -n "launchMode:" Dispatch/Views/MainView.swift
  ```
  </verify>
  <done>
  MainView instantiates EmbeddedTerminalView with .claudeCode launch mode.
  Terminal panel opens Claude Code when toggled (not bash shell).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Terminal panel now launches Claude Code instead of shell</what-built>
  <how-to-verify>
  1. Build and run Dispatch
  2. Press Cmd+Shift+T to open terminal panel
  3. Observe Claude Code launching (look for Claude startup messages)
  4. Verify colored output displays correctly (syntax highlighting, box-drawing chars)
  5. Type a test prompt and press Enter to confirm Claude receives input
  </how-to-verify>
  <resume-signal>Type "approved" if Claude Code launches with colors, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- Build succeeds without errors
- EmbeddedTerminalView instantiated with .claudeCode mode
- Human confirms Claude Code launches in terminal panel
- Human confirms colored output renders correctly
</verification>

<success_criteria>
- MainView line 100 uses launchMode: .claudeCode(...)
- Opening terminal panel launches Claude Code (not bash)
- Claude Code prompt visible in terminal
- Colored output displays correctly (TERM=xterm-256color, COLORTERM=truecolor)
</success_criteria>

<output>
After completion, create `.planning/phases/17-claude-code-integration/17-03-SUMMARY.md`
</output>
