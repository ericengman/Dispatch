---
phase: 22-migration-cleanup
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - Dispatch/Models/Skill.swift
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Skill.runInActiveTerminal() and runInNewTerminal() are deprecated"
    - "External Terminal.app skill execution is not available to new code"
  artifacts:
    - path: "Dispatch/Models/Skill.swift"
      provides: "Deprecated skill terminal execution"
      contains: "@available(*, deprecated"
  key_links:
    - from: "Skill.runInActiveTerminal"
      to: "deprecation annotation"
      via: "@available"
      pattern: "@available.*deprecated"
---

<objective>
Deprecate external Terminal.app skill execution methods

Purpose: Skill.runInActiveTerminal() and runInNewTerminal() use TerminalService to interact with Terminal.app. Since the app now uses embedded terminals exclusively, these methods should be deprecated. Skills should be dispatched via embedded terminal instead.

Output: External skill running methods deprecated, callers warned to use embedded terminal dispatch.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/22-migration-cleanup/22-VERIFICATION.md
@Dispatch/Models/Skill.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deprecate runInActiveTerminal() method</name>
  <files>Dispatch/Models/Skill.swift</files>
  <action>
1. Find the SkillRunner class (around line 422 based on verification report context)

2. Add deprecation annotation to runInActiveTerminal() method (around line 428):
   ```swift
   @available(*, deprecated, message: "Use embedded terminal dispatch instead. Terminal.app execution will be removed in v3.0.")
   func runInActiveTerminal(_ skill: Skill, windowId: String? = nil, pressEnter: Bool? = nil) async throws {
   ```

3. The method body remains unchanged for backward compatibility, but callers will see deprecation warning.

Why: Marking deprecated preserves the code for reference and potential rollback, while warning callers to migrate to embedded terminal dispatch.
  </action>
  <verify>
Build succeeds: `xcodebuild -scheme Dispatch -destination 'platform=macOS' build 2>&1 | tail -20`
Deprecation exists: `grep -n "@available.*deprecated" Dispatch/Models/Skill.swift | grep -i runInActive`
  </verify>
  <done>
runInActiveTerminal() has deprecation annotation
Method body preserved for compatibility
  </done>
</task>

<task type="auto">
  <name>Task 2: Deprecate runInNewTerminal() method</name>
  <files>Dispatch/Models/Skill.swift</files>
  <action>
1. Find the runInNewTerminal() method (around line 461):

2. Add deprecation annotation:
   ```swift
   @available(*, deprecated, message: "Use embedded terminal dispatch instead. Terminal.app execution will be removed in v3.0.")
   func runInNewTerminal(_ skill: Skill, projectPath: URL? = nil, pressEnter: Bool? = nil) async throws {
   ```

3. The method body remains unchanged for backward compatibility.

Why: Same rationale - deprecate to warn callers while preserving rollback option.
  </action>
  <verify>
Build succeeds: `xcodebuild -scheme Dispatch -destination 'platform=macOS' build 2>&1 | tail -20`
Both methods deprecated: `grep -c "@available.*deprecated" Dispatch/Models/Skill.swift` shows at least 2
  </verify>
  <done>
runInNewTerminal() has deprecation annotation
Both external skill execution methods deprecated
App builds successfully
  </done>
</task>

</tasks>

<verification>
- Build: `xcodebuild -scheme Dispatch -destination 'platform=macOS' build`
- Deprecations: `grep -n "@available.*deprecated" Dispatch/Models/Skill.swift` shows both skill methods
- No functional change: Skills still work via deprecated methods (for backward compatibility)
</verification>

<success_criteria>
- runInActiveTerminal() marked deprecated
- runInNewTerminal() marked deprecated
- App builds without errors
- Callers see deprecation warnings when using these methods
</success_criteria>

<output>
After completion, create `.planning/phases/22-migration-cleanup/22-04-SUMMARY.md`
</output>
