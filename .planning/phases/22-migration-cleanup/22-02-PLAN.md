---
phase: 22-migration-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Dispatch/Views/Components/TerminalPickerView.swift
  - Dispatch/Views/Queue/QueuePanelView.swift
  - Dispatch.xcodeproj/project.pbxproj
autonomous: true

must_haves:
  truths:
    - "Terminal.app Automation permission is no longer required"
    - "Queue item rows have no terminal picker button"
    - "No UI elements reference Terminal.app window selection"
  artifacts:
    - path: "Dispatch/Views/Components/TerminalPickerView.swift"
      provides: "Deprecated terminal picker view"
      contains: "@available(*, deprecated"
    - path: "Dispatch/Views/Queue/QueuePanelView.swift"
      provides: "Queue UI without terminal picker"
      pattern: "showingTerminalPicker"
  key_links:
    - from: "QueueItemRowView"
      to: "no TerminalPickerView"
      via: "sheet removed"
      pattern: "!.*TerminalPickerView"
---

<objective>
Remove Terminal.app UI controls and permission requirements

Purpose: Clean up UI that references Terminal.app windows and remove the AppleEvents permission from Info.plist so new installs don't see permission prompts.

Output: No Terminal.app UI controls visible, no automation permission required.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-migration-cleanup/22-RESEARCH.md
@Dispatch/Views/Components/TerminalPickerView.swift
@Dispatch/Views/Queue/QueuePanelView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deprecate TerminalPickerView and remove from QueuePanelView</name>
  <files>
    Dispatch/Views/Components/TerminalPickerView.swift
    Dispatch/Views/Queue/QueuePanelView.swift
  </files>
  <action>
1. In TerminalPickerView.swift:
   - Add deprecation annotation to TerminalPickerView struct:
     ```swift
     @available(*, deprecated, message: "Terminal.app window selection is no longer used. Embedded terminal uses active session.")
     struct TerminalPickerView: View {
     ```
   - Add deprecation annotation to InlineTerminalPicker struct:
     ```swift
     @available(*, deprecated, message: "Terminal.app window selection is no longer used.")
     struct InlineTerminalPicker: View {
     ```
   - Keep implementation for reference

2. In QueuePanelView.swift - QueueItemRowView:
   - Remove `@State private var showingTerminalPicker = false` property
   - Remove the terminal target button entirely (the Button with Label("terminal") around line 176-183)
   - Remove the .sheet(isPresented: $showingTerminalPicker) modifier (lines ~197-204)
   - The item.targetDescription display is no longer needed since embedded terminal auto-targets active session

Why: Terminal window selection is obsolete with embedded terminals. Removing UI prevents user confusion.
  </action>
  <verify>
Build succeeds: `xcodebuild -scheme Dispatch -destination 'platform=macOS' build 2>&1 | tail -20`
No TerminalPickerView usage in QueuePanelView: `grep -n "TerminalPickerView\|showingTerminalPicker" Dispatch/Views/Queue/QueuePanelView.swift`
  </verify>
  <done>
QueueItemRowView has no terminal picker button
TerminalPickerView marked deprecated
QueuePanelView imports no terminal picker
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove AppleEvents permission from Xcode project</name>
  <files>
    Dispatch.xcodeproj/project.pbxproj
  </files>
  <action>
1. Open Dispatch.xcodeproj/project.pbxproj in text editor

2. Find and remove the NSAppleEventsUsageDescription lines:
   - Search for `INFOPLIST_KEY_NSAppleEventsUsageDescription`
   - There are two instances (Debug and Release configurations)
   - Remove both lines entirely:
     - `INFOPLIST_KEY_NSAppleEventsUsageDescription = "Dispatch needs to control Terminal.app to send prompts to Claude Code.";`

3. Verify by searching the file - no NSAppleEventsUsageDescription should remain

Note: This is in the buildSettings sections for both Debug and Release configurations. Remove from both.

Why: Without this key, macOS will not prompt new users for Terminal.app automation permission. Existing users who granted permission keep it in TCC database, but it becomes unused.
  </action>
  <verify>
No NSAppleEventsUsageDescription in project: `grep -n "NSAppleEventsUsageDescription" Dispatch.xcodeproj/project.pbxproj`
Build succeeds: `xcodebuild -scheme Dispatch -destination 'platform=macOS' build 2>&1 | tail -20`
  </verify>
  <done>
NSAppleEventsUsageDescription removed from Debug configuration
NSAppleEventsUsageDescription removed from Release configuration
App builds without Terminal.app permission requirement
  </done>
</task>

</tasks>

<verification>
- Build: `xcodebuild -scheme Dispatch -destination 'platform=macOS' build`
- No permission key: `grep "NSAppleEventsUsageDescription" Dispatch.xcodeproj/project.pbxproj` returns nothing
- No terminal picker in queue: `grep -n "TerminalPickerView" Dispatch/Views/Queue/QueuePanelView.swift` returns nothing
- Deprecation warnings: TerminalPickerView access shows warning
</verification>

<success_criteria>
- TerminalPickerView marked deprecated
- QueueItemRowView has no terminal picker button
- NSAppleEventsUsageDescription removed from project
- App builds and runs
- New installs will not prompt for Terminal.app automation permission
</success_criteria>

<output>
After completion, create `.planning/phases/22-migration-cleanup/22-02-SUMMARY.md`
</output>
