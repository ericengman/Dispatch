---
phase: 13-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Dispatch/Views/Settings/SettingsView.swift
autonomous: true

must_haves:
  truths:
    - "User can access Screenshots tab in Settings window"
    - "User can select a custom screenshot directory"
    - "User can configure max runs per project (5, 10, 20, 50, or unlimited)"
    - "User can reset to default screenshot directory"
  artifacts:
    - path: "Dispatch/Views/Settings/SettingsView.swift"
      provides: "ScreenshotSettingsView struct and screenshots tab"
      contains: "ScreenshotSettingsView"
  key_links:
    - from: "SettingsView.swift"
      to: "AppSettings.screenshotDirectory"
      via: "SettingsManager binding"
      pattern: "screenshotDirectory"
    - from: "SettingsView.swift"
      to: "AppSettings.maxRunsPerProject"
      via: "SettingsManager binding"
      pattern: "maxRunsPerProject"
---

<objective>
Add Screenshots tab to Settings window with configuration for screenshot directory and max runs per project.

Purpose: Users need a way to configure where screenshots are saved and how many runs to keep per project (POLISH-01).
Output: SettingsView.swift with new "Screenshots" tab containing ScreenshotSettingsView.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-polish/13-RESEARCH.md

# Key reference files
@Dispatch/Views/Settings/SettingsView.swift
@Dispatch/Models/AppSettings.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ScreenshotSettingsView and Screenshots tab</name>
  <files>Dispatch/Views/Settings/SettingsView.swift</files>
  <action>
Add new "Screenshots" tab to SettingsView following the established pattern:

1. Add `.screenshots` case to `SettingsTab` enum

2. Add new tab in TabView body (after Projects tab):
```swift
ScreenshotSettingsView()
    .tabItem {
        Label("Screenshots", systemImage: "camera.viewfinder")
    }
    .tag(SettingsTab.screenshots)
```

3. Create `ScreenshotSettingsView` struct following GeneralSettingsView pattern:
- Use `@ObservedObject private var settingsManager = SettingsManager.shared`
- Form with `.formStyle(.grouped)` and `.padding()`

4. Add "Screenshot Storage" section:
- HStack with "Directory:" label and display path (truncated middle)
- "Choose..." button that opens NSOpenPanel (canChooseDirectories, not files)
- "Reset to Default" button (only shown if custom directory set)
- Caption text explaining default location

5. Add "Run Management" section:
- Picker for max runs with options: 5, 10, 20, 50, and 0 (Unlimited)
- Caption explaining older runs are auto-deleted

6. Create bindings following existing pattern:
- `maxRunsBinding: Binding<Int>` for maxRunsPerProject
- `displayPath: String` computed property (shows custom or default)
- `selectDirectory()` function using NSOpenPanel

Reference existing AppSettings properties (already exist):
- `screenshotDirectory: String?`
- `maxRunsPerProject: Int`
  </action>
  <verify>
Build succeeds: `xcodebuild -scheme Dispatch -destination 'platform=macOS' build`
  </verify>
  <done>
Settings window shows Screenshots tab with directory picker and max runs picker. Changes persist via SettingsManager.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Screenshots Settings tab with directory and max runs configuration</what-built>
  <how-to-verify>
1. Run the app
2. Open Settings (Cmd+,)
3. Click "Screenshots" tab
4. Verify:
   - Screenshot Storage section shows current directory path
   - "Choose..." button opens folder picker
   - Selecting a folder updates the display
   - "Reset to Default" appears after setting custom directory
   - Run Management section has picker with 5/10/20/50/Unlimited options
   - Selecting a value persists when closing and reopening Settings
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] Build succeeds without warnings
- [ ] Screenshots tab visible in Settings
- [ ] Directory picker opens NSOpenPanel
- [ ] Custom directory persists to settings
- [ ] Reset to Default clears custom directory
- [ ] Max runs picker has correct options
- [ ] Max runs selection persists
</verification>

<success_criteria>
Settings window has functional Screenshots tab allowing users to:
1. View current screenshot directory
2. Select custom screenshot directory via folder picker
3. Reset to default directory
4. Configure max runs per project (5/10/20/50/Unlimited)
</success_criteria>

<output>
After completion, create `.planning/phases/13-polish/13-01-SUMMARY.md`
</output>
