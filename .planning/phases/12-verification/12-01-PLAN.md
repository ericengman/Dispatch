---
phase: 12-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Running a skill with Dispatch running results in screenshots appearing in Dispatch UI"
    - "Screenshots are organized under the correct project and run in Dispatch"
    - "At least 3 different skills successfully route screenshots to Dispatch"
  artifacts:
    - path: ".planning/phases/12-verification/12-01-E2E-RESULTS.md"
      provides: "E2E test results documentation"
      contains: "screenshots verified in Dispatch UI"
  key_links:
    - from: "skill bash script"
      to: "~/.claude/lib/dispatch.sh"
      via: "source command"
      pattern: "source.*dispatch.sh"
    - from: "dispatch_init"
      to: "http://localhost:19847/screenshots/run"
      via: "curl POST"
      pattern: "screenshots/run"
    - from: "Dispatch UI"
      to: "Screenshot files"
      via: "ScreenshotWatcherService"
      pattern: "scanForNewRuns"
---

<objective>
End-to-end verification of screenshot integration across multiple skills

Purpose: Confirm that the entire screenshot routing pipeline works from skill execution through Dispatch UI display. This is the critical proof that phases 8-11 successfully solved the screenshot routing problem.

Output: Documented E2E test results proving 3+ skills successfully route screenshots to Dispatch.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@~/.claude/lib/dispatch.sh
@~/.claude/skills/test-feature/SKILL.md
@~/.claude/skills/explore-app/SKILL.md
@~/.claude/skills/qa-feature/SKILL.md
@~/.claude/skills/test-dynamic-type/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: E2E Test - Single-Run Pattern Skills</name>
  <files>.planning/phases/12-verification/12-01-E2E-RESULTS.md</files>
  <action>
Test 3 single-run pattern skills with Dispatch running.

**Prerequisites:**
1. Ensure Dispatch app is running (launch if not)
2. Find an iOS project to test against (NOT Dispatch - it's macOS):
   - Check if user has another iOS project open in Xcode
   - Or use a simple iOS app if available
   - If no iOS project available, this test CANNOT proceed - note in results

**Test each skill in sequence:**

For each of: test-feature, explore-app, qa-feature

1. **Pre-test:** Note current run count in Dispatch for the project
2. **Execute skill:** Run the skill against the iOS project
   - The skill will source dispatch.sh, call dispatch_init, take screenshots, call dispatch_finalize
   - Watch for "Dispatch run created" and "Dispatch run finalized" messages in stderr
3. **Verify in Dispatch:**
   - Open Dispatch UI
   - Navigate to the project
   - Verify a new run appears with expected name (e.g., "Feature Test", "App Exploration", "QA: FeatureName")
   - Verify screenshots are visible within the run
   - Count screenshots - should match what skill took
4. **Document results:** Record skill name, run created (Y/N), screenshots visible (count), any issues

**If no iOS project available:**
- Document that E2E testing requires an iOS project
- Note that the library integration was verified in Phase 8 (see 08-VERIFICATION.md)
- Suggest user test manually when iOS project is available
  </action>
  <verify>
- Dispatch shows runs for at least 3 skills
- Each run contains the expected screenshots
- No error messages in skill output
  </verify>
  <done>At least 3 single-run skills have successfully routed screenshots to Dispatch UI</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
End-to-end screenshot routing from skills to Dispatch UI.

Tested 3+ skills:
1. test-feature (single-run pattern)
2. explore-app (single-run pattern)
3. qa-feature (single-run pattern)

Each skill:
- Sources ~/.claude/lib/dispatch.sh
- Calls dispatch_init to create a run
- Saves screenshots to $DISPATCH_SCREENSHOT_PATH
- Calls dispatch_finalize to complete the run
  </what-built>
  <how-to-verify>
1. Open Dispatch app
2. Navigate to the test project in sidebar
3. Verify you see screenshot runs with names like:
   - "Feature Test"
   - "App Exploration"
   - "QA: [FeatureName]"
4. Click into each run and verify screenshots are displayed
5. Try annotating a screenshot (draw on it) to confirm full workflow
6. Optionally: Click "Dispatch to Claude" to verify dispatch still works
  </how-to-verify>
  <resume-signal>Type "verified" if screenshots appear correctly in Dispatch, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
## E2E Verification Checks

1. **Skill Output Check:**
   - Skills output "Dispatch run created: [uuid]" to stderr
   - Skills output "Screenshots will be saved to: [path]" to stderr
   - Skills output "Dispatch run finalized - screenshots ready for review" to stderr

2. **Dispatch UI Check:**
   - Runs appear in project sidebar
   - Run names match skill-provided names
   - Screenshots are visible and can be annotated

3. **File System Check (optional):**
   - Screenshots exist at `~/Library/Application Support/Dispatch/Screenshots/[project]/[run-uuid]/`
</verification>

<success_criteria>
- At least 3 skills successfully executed with Dispatch integration
- All skill runs appear in Dispatch UI
- Screenshots are visible and accessible in Dispatch
- No errors in skill execution related to Dispatch integration
- VERIFY-01 and VERIFY-03 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/12-verification/12-01-SUMMARY.md`
</output>
