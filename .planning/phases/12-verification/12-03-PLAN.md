---
phase: 12-verification
plan: 03
type: execute
wave: 2
depends_on: [12-01, 12-02]
files_modified:
  - ~/.claude/skills/test-feature/SKILL.md
  - ~/.claude/skills/explore-app/SKILL.md
  - ~/.claude/skills/qa-feature/SKILL.md
  - ~/.claude/skills/test-dynamic-type/SKILL.md
  - Docs/external-files/dispatch-lib.md
autonomous: true

must_haves:
  truths:
    - "Each skill documents the Dispatch integration pattern"
    - "Library documentation explains both single-run and multi-run patterns"
    - "Skills reference the shared library, not inline code"
  artifacts:
    - path: "Docs/external-files/dispatch-lib.md"
      provides: "Updated library documentation"
      contains: "dispatch_init"
    - path: "~/.claude/skills/test-feature/SKILL.md"
      provides: "Skill documentation"
      contains: "source ~/.claude/lib/dispatch.sh"
  key_links:
    - from: "skill SKILL.md"
      to: "dispatch.sh library"
      via: "documentation reference"
      pattern: "source.*dispatch.sh"
---

<objective>
Update skill and library documentation with verified integration patterns

Purpose: Ensure documentation accurately reflects the working integration patterns, making it easy for future skill development to follow the same approach. This is the final polish that ensures the screenshot routing solution is fully documented.

Output: Updated skill SKILL.md files and library documentation with accurate integration instructions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-verification/12-01-E2E-RESULTS.md
@.planning/phases/12-verification/12-02-FALLBACK-RESULTS.md
@~/.claude/lib/dispatch.sh
@Docs/external-files/dispatch-lib.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Library Documentation</name>
  <files>Docs/external-files/dispatch-lib.md</files>
  <action>
Update the library documentation to include:

1. **Verified Integration Patterns** - Document both patterns with examples that match what was verified in 12-01:

**Single-Run Pattern** (for test-feature, explore-app, qa-feature):
```bash
source ~/.claude/lib/dispatch.sh

# Initialize at start of skill
dispatch_init "Run Name" "$DEVICE_INFO"

# Take screenshots during skill execution
mcp__ios-simulator__screenshot(path: "$DISPATCH_SCREENSHOT_PATH/screenshot.png")

# Finalize when complete
dispatch_finalize
```

**Multi-Run Pattern** (for test-dynamic-type):
```bash
source ~/.claude/lib/dispatch.sh

for CONFIG in config1 config2 config3; do
    # Create a run for each configuration
    dispatch_init "Test - $CONFIG" "$DEVICE_INFO"

    # Source state to get variables
    source "$DISPATCH_STATE_FILE"

    # Take screenshots for this configuration
    # ... screenshots saved to $DISPATCH_SCREENSHOT_PATH ...

    # Finalize before next iteration
    dispatch_finalize
done
```

2. **Fallback Behavior** - Document verified fallback:
- When Dispatch is not running, screenshots go to /tmp/screenshots-[timestamp]
- Clear messages explain where screenshots are saved
- Skills continue working without Dispatch

3. **Verification Results** - Reference the Phase 12 verification:
- Link to or summarize 12-01-E2E-RESULTS.md and 12-02-FALLBACK-RESULTS.md
- Note which skills were tested and passed

4. **API Reference** - Ensure functions are documented:
- dispatch_init(run_name, device_info) - Creates screenshot run
- dispatch_finalize() - Completes run, triggers scan
- dispatch_check_health() - Returns 0 if Dispatch running
- dispatch_get_project_name() - Returns git repo name
- dispatch_get_state() - Debug helper, outputs state file

Read existing Docs/external-files/dispatch-lib.md first, then update with verified patterns.
  </action>
  <verify>
- Documentation includes single-run and multi-run pattern examples
- Fallback behavior documented
- All 5 functions documented
- Examples match actual working code from skills
  </verify>
  <done>Library documentation updated with verified integration patterns</done>
</task>

<task type="auto">
  <name>Task 2: Verify Skill Documentation Consistency</name>
  <files>~/.claude/skills/test-feature/SKILL.md, ~/.claude/skills/explore-app/SKILL.md, ~/.claude/skills/qa-feature/SKILL.md, ~/.claude/skills/test-dynamic-type/SKILL.md</files>
  <action>
Review each skill's SKILL.md and ensure the Dispatch integration section:

1. **References the shared library** - Not inline curl commands
2. **Shows correct pattern** - Single-run or multi-run as appropriate
3. **Documents fallback** - Mentions graceful degradation
4. **Is consistent** - All skills use same terminology and approach

For each skill, check:
- Has "Dispatch Screenshot Integration" section
- Sources `~/.claude/lib/dispatch.sh`
- Calls `dispatch_init` with appropriate run name
- Uses `$DISPATCH_SCREENSHOT_PATH` for screenshots
- Calls `dispatch_finalize` at cleanup
- Mentions fallback behavior

**Read each SKILL.md file and verify these elements are present.**

If any skill is missing elements or has outdated documentation:
- Update the SKILL.md to match the verified pattern
- Keep changes minimal - just update the integration section

Skills to check:
1. ~/.claude/skills/test-feature/SKILL.md (single-run)
2. ~/.claude/skills/explore-app/SKILL.md (single-run)
3. ~/.claude/skills/qa-feature/SKILL.md (single-run)
4. ~/.claude/skills/test-dynamic-type/SKILL.md (multi-run)
  </action>
  <verify>
- All 4 skills document the library sourcing pattern
- Single-run skills show dispatch_init/dispatch_finalize once
- Multi-run skill shows dispatch_init/dispatch_finalize in loop
- All mention fallback behavior
  </verify>
  <done>All 4 skill SKILL.md files verified consistent with integration pattern</done>
</task>

</tasks>

<verification>
## Documentation Verification

1. **Library Documentation:**
   - dispatch-lib.md exists and is complete
   - Both patterns (single-run, multi-run) documented with examples
   - Fallback behavior explained
   - All 5 functions have documentation

2. **Skill Documentation:**
   - All 4 skills reference shared library
   - Integration sections are accurate and consistent
   - Fallback mentioned in each skill
</verification>

<success_criteria>
- Library documentation updated with verified patterns
- All 4 skill SKILL.md files are consistent
- Documentation matches actual working code
- VERIFY-04 requirement satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/12-verification/12-03-SUMMARY.md`
</output>
